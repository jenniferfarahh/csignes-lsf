generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String @id            // google "sub"
  email     String @unique
  firstName String?
  lastName  String?
  picture   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  progress  UserProgress?
}

model Lesson {
  id           String   @id
  title        String
  videoUrl     String
  question     String
  choices      String[]
  correctIndex Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  attempts LessonAttempt[]
}

model UserProgress {
  userId           String   @id
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  xp               Int      @default(0)
  completedLessons String[] @default([])

  lastLessonId   String?
  lastUserAnswer Int?
  lastWasCorrect Boolean?
  lastXpEarned   Int?
  updatedAt      DateTime @updatedAt

  attempts LessonAttempt[]
  gameAttempts GameAttempt[]
}

model LessonAttempt {
  id       String @id @default(cuid())
  userId   String
  lessonId String

  selectedIndex Int
  isCorrect     Boolean
  xpAwarded     Int     @default(0)

  createdAt DateTime @default(now())

  user   UserProgress @relation(fields: [userId], references: [userId])
  lesson Lesson       @relation(fields: [lessonId], references: [id])

  @@unique([userId, lessonId]) // 1 seule tentative par user pour cette le√ßon
}

model Sign {
  id          String   @id @default(cuid())
  word        String
  description String?
  videoUrl    String
  category    String
  difficulty  String

  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt

  @@unique([word, category])
}

model GameAttempt {
  id        String   @id @default(cuid())
  userId    String
  gameId    String
  score     Int
  xpAwarded Int
  createdAt DateTime @default(now())

  user UserProgress @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId, gameId])
}